{"version":3,"file":"static/js/113.dbba6571.chunk.js","mappings":"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","sources":["utils/constants.js","views/admin/Dashboard.js"],"sourcesContent":["export const baseUrl = \"http://localhost:3001\";\r\n","import React, { useEffect, useState } from \"react\";\r\nimport { Button, ButtonGroup, Container, Modal, Form } from \"react-bootstrap\";\r\nimport { Pie } from \"react-chartjs-2\";\r\nimport io from \"socket.io-client\";\r\nimport \"chart.js/auto\";\r\nimport ChartDataLabels from \"chartjs-plugin-datalabels\";\r\nimport { FiDownload } from \"react-icons/fi\";\r\nimport { Chart } from \"chart.js\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { selectToken } from \"../../store/authSlice\";\r\nimport axios from \"axios\"; // Import axios\r\nimport { baseUrl } from \"../../utils/constants\";\r\nconst socket = io(baseUrl);\r\nChart.register(ChartDataLabels);\r\n\r\nconst AdminDashboard = () => {\r\n  // Access the token from Redux store\r\n  const token = useSelector(selectToken);\r\n  const [reportData, setReportData] = useState({\r\n    today: [],\r\n    last7Days: [],\r\n    thisMonth: [],\r\n  });\r\n\r\n  const [currentReport, setCurrentReport] = useState(\"today\");\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [fromDate, setFromDate] = useState(\"\");\r\n  const [toDate, setToDate] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const currentDate = new Date().toISOString().split(\"T\")[0];\r\n\r\n  // Fetch initial report data from the API\r\n  const fetchReportData = async () => {\r\n    try {\r\n      const response = await axios.get(\r\n        `${baseUrl}/api/report/mis-report`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`,\r\n          },\r\n        }\r\n      );\r\n      setReportData(response.data);\r\n    } catch (error) {\r\n      console.error(\"Error fetching report data:\", error);\r\n    }\r\n  };\r\n\r\n  // Listen for data from the socket server\r\n  useEffect(() => {\r\n    fetchReportData();\r\n    socket.on(\"misReport\", (data) => {\r\n      console.log(\"Received MIS Report:\", data);\r\n      setReportData(data);\r\n    });\r\n\r\n    return () => {\r\n      socket.off(\"misReport\");\r\n    };\r\n  }, []);\r\n\r\n  // Generate data for the Pie chart based on the selected report\r\n  const generateChartData = () => {\r\n    const data = reportData[currentReport] || [];\r\n    const labels = data.map((item) => item.category);\r\n    const counts = data.map((item) => item.count);\r\n    const colors = [\"#28a745\", \"#ffc107\", \"#a3231f\", \"#d6204e\"];\r\n\r\n    return {\r\n      datasets: [\r\n        {\r\n          data: counts,\r\n          backgroundColor: colors,\r\n          hoverOffset: 4,\r\n        },\r\n      ],\r\n      labels,\r\n    };\r\n  };\r\n\r\n  // Chart options with datalabel configuration\r\n  const chartOptions = {\r\n    plugins: {\r\n      legend: {\r\n        labels: {\r\n          color: \"white\",\r\n        },\r\n      },\r\n      datalabels: {\r\n        color: \"white\",\r\n        display: true,\r\n        anchor: \"center\",\r\n        align: \"center\",\r\n        formatter: (value) => {\r\n          return value;\r\n        },\r\n      },\r\n    },\r\n  };\r\n\r\n  // Function to handle download report\r\n  const downloadReport = async () => {\r\n    if (!fromDate || !toDate) {\r\n      setError(\"Please enter both dates.\");\r\n      return;\r\n    }\r\n\r\n    if (new Date(fromDate) > new Date(toDate)) {\r\n      setError(\"From Date must be earlier than To Date.\");\r\n      return;\r\n    }\r\n\r\n    setError(\"\");\r\n    try {\r\n      const response = await axios.get(\r\n        `${baseUrl}/api/report/mis-download?fromDate=${fromDate}&toDate=${toDate}`,\r\n        {\r\n          headers: {\r\n            Authorization: `Bearer ${token}`, // Include the token in the request headers\r\n          },\r\n        }\r\n      );\r\n      const url = window.URL.createObjectURL(new Blob([response.data]));\r\n      const link = document.createElement(\"a\");\r\n      link.href = url;\r\n      link.setAttribute(\"download\", \"MISReport.csv\");\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      link.remove();\r\n    } catch (error) {\r\n      console.error(\"Error downloading report:\", error);\r\n    } finally {\r\n      setShowModal(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        backgroundColor: \"#343a40\",\r\n        color: \"white\",\r\n        minHeight: \"100vh\",\r\n        paddingTop: \"20px\",\r\n      }}\r\n    >\r\n      <Container>\r\n        <div className=\"d-flex justify-content-end mt-3\">\r\n          <Button\r\n            variant=\"outline-primary\"\r\n            onClick={() => setShowModal(true)}\r\n            className=\"me-3 mt-3\"\r\n          >\r\n            <FiDownload\r\n              size={30}\r\n              style={{ cursor: \"pointer\", color: \"white\" }}\r\n              title=\"Download Report\"\r\n            />\r\n          </Button>\r\n        </div>\r\n        <div\r\n          className=\"chart-container\"\r\n          style={{ width: \"40%\", margin: \"0 auto\" }}\r\n        >\r\n          <Pie data={generateChartData()} options={chartOptions} />\r\n        </div>\r\n\r\n        <ButtonGroup className=\"mb-3 d-flex justify-content-center mt-5\">\r\n          <Button\r\n            variant={currentReport === \"today\" ? \"primary\" : \"outline-primary\"}\r\n            onClick={() => setCurrentReport(\"today\")}\r\n          >\r\n            Today\r\n          </Button>\r\n          <Button\r\n            variant={\r\n              currentReport === \"last7Days\" ? \"primary\" : \"outline-primary\"\r\n            }\r\n            onClick={() => setCurrentReport(\"last7Days\")}\r\n          >\r\n            Last 7 Days\r\n          </Button>\r\n          <Button\r\n            variant={\r\n              currentReport === \"thisMonth\" ? \"primary\" : \"outline-primary\"\r\n            }\r\n            onClick={() => setCurrentReport(\"thisMonth\")}\r\n          >\r\n            Last 30 Days\r\n          </Button>\r\n        </ButtonGroup>\r\n\r\n        <Modal show={showModal} onHide={() => setShowModal(false)}>\r\n          <Modal.Header closeButton>\r\n            <Modal.Title>Download Report</Modal.Title>\r\n          </Modal.Header>\r\n          <Modal.Body>\r\n            {error && <div className=\"text-danger\">{error}</div>}\r\n            <Form>\r\n              <Form.Group controlId=\"fromDate\">\r\n                <Form.Label>From Date</Form.Label>\r\n                <Form.Control\r\n                  type=\"date\"\r\n                  value={fromDate}\r\n                  max={currentDate}\r\n                  onChange={(e) => setFromDate(e.target.value)}\r\n                />\r\n              </Form.Group>\r\n              <Form.Group controlId=\"toDate\">\r\n                <Form.Label>To Date</Form.Label>\r\n                <Form.Control\r\n                  type=\"date\"\r\n                  value={toDate}\r\n                  max={fromDate ? fromDate : currentDate}\r\n                  onChange={(e) => setToDate(e.target.value)}\r\n                />\r\n              </Form.Group>\r\n            </Form>\r\n          </Modal.Body>\r\n          <Modal.Footer>\r\n            <Button variant=\"secondary\" onClick={() => setShowModal(false)}>\r\n              Close\r\n            </Button>\r\n            <Button variant=\"primary\" onClick={downloadReport}>\r\n              Download\r\n            </Button>\r\n          </Modal.Footer>\r\n        </Modal>\r\n      </Container>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminDashboard;\r\n"],"names":["baseUrl","socket","io","Chart","register","ChartDataLabels","AdminDashboard","token","useSelector","selectToken","reportData","setReportData","useState","today","last7Days","thisMonth","currentReport","setCurrentReport","showModal","setShowModal","fromDate","setFromDate","toDate","setToDate","error","setError","currentDate","Date","toISOString","split","useEffect","async","response","axios","get","headers","Authorization","data","console","fetchReportData","on","log","off","_jsx","style","backgroundColor","color","minHeight","paddingTop","children","_jsxs","Container","className","Button","variant","onClick","FiDownload","size","cursor","title","width","margin","Pie","generateChartData","labels","map","item","category","datasets","count","hoverOffset","options","plugins","legend","datalabels","display","anchor","align","formatter","value","ButtonGroup","Modal","show","onHide","Header","closeButton","Title","Body","Form","Group","controlId","Label","Control","type","max","onChange","e","target","Footer","url","window","URL","createObjectURL","Blob","link","document","createElement","href","setAttribute","body","appendChild","click","remove"],"sourceRoot":""}